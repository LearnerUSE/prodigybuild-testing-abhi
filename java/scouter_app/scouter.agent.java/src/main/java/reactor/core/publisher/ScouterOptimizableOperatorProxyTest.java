// This code is not testable as it relies on external dependencies and static state.
// To make it testable, we'll need to refactor the code to reduce the dependencies on external classes and remove the static state.
// The refactored code will need to be redesigned to follow SOLID principles and promote testability.